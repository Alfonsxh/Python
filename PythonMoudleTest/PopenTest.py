"""
@file: PopenTest.py
@time: 2018/09/27
@author: sch
"""
import time
import os
import signal
import psutil
from subprocess import Popen, PIPE


def KillProcByPid(pid):
    """
    根据进程id杀死对应进程下的所有进程，包括子进程
    :param pid: 进程ID
    :return:
    """
    proc = psutil.Process(pid)
    childProc = proc.children(recursive = True)
    for p in childProc:
        os.kill(p.pid, signal.SIGKILL)
    os.kill(pid, signal.SIGKILL)


# airodumpProc = Popen(["/usr/local/sbin/airodump-ng", "wlan0"])
airodumpProc = Popen("/usr/local/sbin/airodump-ng wlan0", shell = True)

time.sleep(10)
# airodumpProc.kill()
KillProcByPid(airodumpProc.pid)

while True:
    time.sleep(3)
